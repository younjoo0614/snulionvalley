<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    {% load static %} <!-- ì¶”ê°€ --> 
    <link rel="stylesheet" href="{% static 'map/index.css' %}">
</head>
<body>

  <div class = "header">
      <div class="title">  ê·¸ë¦°ë¼ì´íŠ¸ë¥¼ 'ì¢€ë§Œ ë”' ì¼œì¤˜!</div>
      <div class="dsc"> 2020-1 ë¹„ì£¼ì–¼ë¼ì´ì œì´ì…˜<br/>
          ì—´ì‹œì— ë§Œë‚˜ì¡° : ê¹€ë¯¼ê· , ë°±ì§€ìˆ˜, ìœ¤ì•„ëŒ, ì´ì‚¬ì€, ì´í˜œë¯¼
      </div>
  </div>

  <div class="article">
      <p> ì–´ë–¤ íš¡ë‹¨ë³´ë„ë¥¼ ê±´ë„ˆë‹¤ ì‹ í˜¸ë“±ì˜ ê¸¸ì´ê°€ ë„ˆë¬´ ì§§ë‹¤ê³  ëŠë‚€ ì ì´ ìˆìœ¼ì‹ ê°€ìš”? </p>
      <p> ë‚˜ë¦„ í‰ê·  ë³´í–‰ ì†ë„ë¥¼ ê°€ì¡Œë‹¤ê³  í•  ìˆ˜ ìˆëŠ” ì„±ì¸ ë‚¨ì„±/ì—¬ì„±ì—ê²Œ ì‹ í˜¸ë“±ì˜ ê¸¸ì´ê°€ ì§§ê²Œ ëŠê»´ì§„ë‹¤ë©´, </p>
      <p> ë…¸ì¸ì´ë‚˜ ì–´ë¦°ì•„ì´ë“¤ê³¼ ê°™ì€ ë³´í–‰ ì•½ìë“¤ì—ê²ŒëŠ” ì‹ í˜¸ë“±ì˜ ì ë“±ì‹œê°„ì´ ìˆœì‹ê°„ì— ëë‚˜ë²„ë¦¬ëŠ” ê²ƒì²˜ëŸ¼ ëŠê»´ì§ˆì§€ë„ ëª¨ë¦…ë‹ˆë‹¤.  </p>
      </br>
      </br>
      <p>ê·¸ë ‡ë‹¤ë©´ ì´ëŸ¬í•œ ì‹ í˜¸ë“± ê¸¸ì´ëŠ” ì–´ë–»ê²Œ ì±…ì •ë˜ëŠ” ê²ƒì¼ê¹Œìš”?</p>
      </br>
      <img class="road" src="{% static 'map/images/road.jpeg' %}" width="400px">
      <p>ê³¼ì—° ì´ëŸ¬í•œ ì„¤ì • ê¸°ì¤€ì€ ì ë‹¹í•œ ê¸°ì¤€ì´ë¼ í•  ìˆ˜ ìˆì„ê¹Œìš”?</p>
      </br>
      </br>
      <img class="road" src="{% static 'map/images/road.jpeg' %}" width="400px">
      </br>
      </br>
      <p>ëŒ€í•œê³µê°„ì •ë³´í•™íšŒì§€ì˜ 2015ë…„ ì—°ë ¹ë³„ ë³´í–‰ì†ë„ ì—°êµ¬ ê²°ê³¼ë¥¼ ê¸°ì¤€ìœ¼ë¡œ, ì„œìš¸ì‹œ ë‚´ 40mì´ìƒì˜ íš¡ë‹¨ë³´ë„ ëŒ€ìƒìœ¼ë¡œ ì í•©ì„±ì„ ì¡°ì‚¬í•´ë³´ì•˜ìŠµë‹ˆë‹¤.</p>
      <p>íš¡ë‹¨ë³´ë„ì˜ ì ìˆ˜ëŠ” ì—°ë ¹êµ¬ê°„ ë³„ë¡œ (í‘œì¤€ ì ì • ì‹œê°„ - í˜„ì¬ ë³´í–‰ ì‹ í˜¸ ì‹œê°„) * (í•´ë‹¹ êµ¬ì˜ ì¸êµ¬ ë¹„ìœ¨) ì˜ í•©ìœ¼ë¡œ ì‚°ì¶œí–ˆìŠµë‹ˆë‹¤.</p>
      <p>(í‘œì¤€ ì ì • ì‹œê°„ = í•™íšŒì§€ì˜ ë³´í–‰ì†ë„ ê¸°ì¤€ì„ ë°”íƒ•ìœ¼ë¡œ ì‚°ì¶œí•œ íš¡ë‹¨ë³´ë„ë¥¼  ë³´í–‰í•˜ëŠ” ë° í•„ìš”í•œ ì‹œê°„)</p>
      <p>íš¡ë‹¨ë³´ë„ë“¤ì€ ëª¨ë‘ì—ê²Œ Green light ì¼ê¹Œìš”?</p>
  
      
      <div id="chart"></div>

      <div class = "filter">
        <div class="all"><a href="/map/index#chart">ALL</a></div>
        <div class="red"><a href="/map/red#chart">0ì ~5ì </a></div>
        <div class="orange">5ì ~10ì </div>
        <div class="yellow"><a href="/map/yellow#chart">10ì ~15ì </a></div>
        <div class="green"><a href="/map/green#chart">15ì ~20ì </a></div>
      </div>

      <p>ì‹¤ì œë¡œ ì–´ë¦°ì•„ì´ë‚˜, ë…¸ì¸ì˜ ê²½ìš°ëŠ” ëŒ€ë¶€ë¶„ì˜ íš¡ë‹¨ë³´ë„ì—ì„œ ê±´ë„ˆì§€ ëª»í•˜ê³  ìˆì—ˆìŠµë‹ˆë‹¤.</p> 
      <p>ì œì¼ ì‹¬í•˜ê²ŒëŠ”,</p>
      </br>
      </br>
      </br>
      <p>(ì°¨íŠ¸ ì„¤ëª…í•˜ëŠ” ë§) â† ì°¨íŠ¸ ë‚˜ì˜¤ê³  ì¶”ê°€í•˜ëŠ” ê²Œ ì¢‹ì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤! ğŸ˜ƒ</p>
      </br>
      <p>ì¢€ ë” ì‚´í´ë³¼ê¹Œìš”? ğŸ”</p>
      </br>
      </br>
      </br>
      </br>
      <p>ì¡°ì‚¬ë¥¼ í•´ë³´ë‹ˆ, ì±…ì •ëœ ë³´í–‰ ì‹œê°„ì€ ì˜¤ë˜ë˜ì–´ í˜„ì‹¤ì„ ë°˜ì˜í•˜ì§€ ëª»í•˜ê³  ìˆì—ˆìŠµë‹ˆë‹¤.</p>
      <p>í˜„ì¬ ì±…ì •ëœ ë³´í–‰ ì‹œê°„ì€ ë„ë¡œêµí†µì•ˆì „í˜‘íšŒê°€ ì‹¤ì‹œí•œ â€˜íš¡ë‹¨ë³´ë„ ë³´í–‰ìì˜ íš¡ë‹¨íŠ¹ì„±ì— ê´€í•œ ì—°êµ¬â€™ ê²°ê³¼ì— ë”°ë¥¸ ê²ƒì…ë‹ˆë‹¤. </p>
      <p>ê·¸ëŸ°ë° ì´ ì—°êµ¬ëŠ” 28ë…„ ì „ì¸ 1992ë…„ì— ì‹¤ì‹œ ëì„ ë¿ë§Œ ì•„ë‹ˆë¼ ì¡°ì‚¬ ëŒ€ìƒë„ â€˜ì„œìš¸ì‹œ ë‚´ 20ê°œ êµì°¨ë¡œâ€™ë¡œ êµ­í•œë¼ ìˆìŠµë‹ˆë‹¤.</p>
      <p>ëª¨ë“  ì‚¬ëŒë“¤ì—ê²Œ Green Lightê°€ ë˜ê¸° ìœ„í•´ì„œëŠ”, ìƒˆë¡œìš´ ê¸°ì¤€ì´ ì±…ì •ë  í•„ìš”ê°€ ìˆì§€ ì•Šì„ê¹Œìš”?</p>
      <p>ì´ìƒ 'ì—´ì‹œì—ë§Œë‚˜ì¡°'ì˜€ìŠµë‹ˆë‹¤. </p>

  </div> 

  <div class="footer">
      <p> Reference <br/>
          <a href="https://gist.github.com/e9t/ba9edd99793a5c91eaab">code</a>
          by <a href="http://lucypark.kr">Lucy Park</a>
          <br>
          <a href="http://opensource.org/licenses/Apache-2.0">Licensed with Apache 2.0</a>
        </p>
  </div>



    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="https://d3js.org/queue.v1.min.js"></script>
    <script src="http://d3js.org/topojson.v1.min.js"></script>
    <script>
    var width = 1100,
        height = 700;

    var minColor = 'red',
        meanColor = 'yellow',
        maxColor = 'green';

    var minValue = 0,
        meanValue = 10,
        maxValue = 20; // TODO: automate

    var legendWidth = 15,
        legendHeight = 150,
        margin = { left: 780, top: 440 };

  // define color scale
    var colorScale = d3.scale.linear()
        .range([minColor, meanColor, maxColor]) // or use hex values
        .domain([minValue, meanValue, maxValue]);
        //.interpolator(d3.interpolateSpectral);

    var sizeScale = d3.scale.linear()
        .domain([minValue, maxValue]);

  // define projection and path
    var projection = d3.geo.mercator()
        .center([126.9895, 37.5651])
        .scale(80000)
        .translate([2*width/5, height/2]);

    var path = d3.geo.path().projection(projection);

  // add canvas
    var svg = d3.select("#chart").append("svg")
        .attr("width", width)
        .attr("height", height);

    var map = svg.append("g").attr("id", "map"),
        points = svg.append("g").attr("id", "places"),
        legend = svg.append("g").attr("id", "legend");

  // add legend for colors
    var legendBar = legend.append("defs").append("linearGradient")
        .attr("id", "gradient")
        .attr("x1", "100%")
        .attr("y1", "0%")
        .attr("x3","100%")
        .attr("y3", "50%")
        .attr("x2", "100%")
        .attr("y2", "100%")
        .attr("spreadMethod", "pad");

    legendBar.append("stop")
        .attr("offset", "0%")
        .attr("stop-color", maxColor)
        .attr("stop-opacity", 1);

    legendBar.append("stop")
        .attr("offset", "50%")      
        .attr("stop-color", meanColor)
        .attr("stop-opacity", 1);    

    legendBar.append("stop")
        .attr("offset", "100%")
        .attr("stop-color", minColor)
        .attr("stop-opacity", 1);

    legend.append("rect")
        .attr("width", legendWidth)
        .attr("height", legendHeight)
        .style("fill", "url(#gradient)")
        .style("opacity", 0.5)
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    var y = d3.scale.linear().range([legendHeight, 0]).domain([minValue, maxValue]);
    var yAxis = d3.svg.axis().scale(y).orient("right");

    legend.append("g")
        .attr("class", "axis")
        .attr("transform", "translate(" + (legendWidth + margin.left) + "," + margin.top + ")")
        .call(yAxis)
        .append("text")
        .attr("transform", "rotate(-90)")
        .attr("y", 30)
        .attr("dy", ".71em")
        .style("text-anchor", "end")
        .text("(ë‹¨ìœ„: ì )");

  // add map
    d3.json("{% static 'map/seoul_municipalities_topo_simple.json' %}", function(error, data) {
        var features = topojson.feature(data, data.objects.seoul_municipalities_geo).features;
        map.selectAll('path')
            .data(features)
        .enter().append('path')
            .attr('class', function(d) { console.log(); return 'municipality c' + d.properties.code })
            .attr('d', path);

        map.selectAll('text')
            .data(features)
        .enter().append('text')
            .attr('transform', function(d) { return 'translate(' + path.centroid(d) + ')'; })
            .attr('dy', '.35em')
            .attr('class', 'municipality-label')
        .text(function(d) { return d.properties.name; })
  });

  // add circles
    d3.csv("{% static 'map/places.csv'%}", function(data) {
        var point = points.selectAll("circle")
            .data(data.filter(function(d) { return d.col == "orange"; }))
        .enter().append("a")
            // .attr("xlink:href", function(d) { return d.url }); 

        point.append("circle")
            .attr("cx", function(d) { return projection([d.lon, d.lat])[0]; })
            .attr("cy", function(d) { return projection([d.lon, d.lat])[1]; })
            .attr("r", 6)
            .style("fill", function(d) { return colorScale(d.score); });

    // add circle labels
        var labels = [],
            labelLinks = [];

    data.forEach(function(d, i) {
        var p = projection([d.lon, d.lat]);
        var node = {
            //label: d.name,
            x: p[0],
            y: p[1]
      };
      labels.push({node : node }); labels.push({node : node }); // push twice
      labelLinks.push({ source : i * 2, target : i * 2 + 1, weight : 1, x: 100 });
    });

    var force = d3.layout.force()
        .nodes(labels)
        .links(labelLinks)
        .gravity(0)
        .linkDistance(0)
        .linkStrength(8)
        .charge(-100)
        .size([width, height])
        .on("tick", tick);

    function tick() {
      circleNode.call(updateNode);
      labelNode.each(function(d, i) {
        if(i % 2 == 0) {
          d.x = d.node.x;
          d.y = d.node.y;
        } else {
          var b = this.childNodes[1].getBBox();
          var diffX = d.x - d.node.x,
              diffY = d.y - d.node.y;
          var dist = Math.sqrt(diffX * diffX + diffY * diffY);
          var shiftX = Math.min(0, b.width * (diffX - dist) / (dist * 2));
          var shiftY = 5;
          this.childNodes[1].setAttribute("transform", "translate(" + shiftX + "," + shiftY + ")");
        }
      });
      labelNode.call(updateNode);
    }

    var circleNode = points.selectAll("circle")
        .data(points)
      .enter().append("circle")
        .attr("class", "node")
        .attr("r", 5)
        .style("fill", "#555")
        .style("stroke-width", 3);

    var labelNode = points.selectAll("g")
        .data(force.nodes())
      .enter().append("g")
        .attr("class", "labelNode");

    labelNode.append("circle")
        .attr("r", 0)
        .style("fill", "red");

    labelNode.append("text")
        .text(function(d, i) { return i % 2 == 0 ? "" : d.node.label })
        .style("fill", "#555")
      var updateNode = function() {
        this.attr("transform", function(d) {
          return "translate(" + d.x + "," + d.y + ")";
        });
      }

    force.start();
  });

    </script>
</body>
</html>